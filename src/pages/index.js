import Head from 'next/head'
import apolloClient from './../apollo'
import Link from 'next/link'
import { gql } from '@apollo/client'
import { useRouter } from 'next/router'

export default function Home({ posts }) {
  const router = useRouter()
  return (
    <>
      <Head>
        <title>Jugometal app</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <div>
        <h1>Hello,</h1>
        <Link href='/about'>Go to about</Link>

        {posts &&
          posts.map((data, index) => (
            <div key={data.id}>
              <h3>{data.productDetails.naslov}</h3>
              <p>{data.productDetails.prviOpis}</p>
              <Link href={`/${data.slug}`}>Dalje</Link>
              <hr />
            </div>
          ))}
      </div>
    </>
  )
}

export const getStaticProps = async () => {
  const { data } = await apolloClient.query({
    query: gql`
      query {
        posts(where: { categoryName: "featured" }) {
          nodes {
            productDetails {
              brend
              category
              drugiOpis
              k1
              k2
              k3
              k4
              k5
              naslov
              prviOpis
              subcategory
              slika {
                sourceUrl
              }
            }
            id
            slug
          }
        }
        mediaItems(where: { title: "jugovideo" }) {
          nodes {
            mediaItemUrl
            title
          }
        }
      }
    `,
  })

  const posts = data.posts.nodes
  const media = data.mediaItems.nodes

  return {
    props: {
      posts,
      media,
    },
    revalidate: 120,
  }
}
